<html>
<head>
	<title>Planetarium</title>
	<style>
	body { 
		margin: 0;
		background: black;
	}
	canvas { width: 100%; height: 100% }
	#frontpage {
		background: black;
		color: white;
		width: 100%;
		height: 100%;
		font-family: "Helvetica Neue";
	}
	#title {
		font-size: 60pt;
		font-weight: 100;
	}
	#intro {
		font-size: 35pt;
		font-weight: 100;
	}
	#start {
		font-family: "Helvetica Neue";
		color: darkred;
		background: black;
		font-size: 40pt;
		font-weight: 100;
		position: relative;
		top: 60%;
		left: 65%;
		cursor: pointer;
	}
	#start:hover {
		color: blue;
	}
	#button {
		font-family: "Helvetica Neue";
		color: white;
		font-size: 30pt;
		font-weight: 100;
		position: relative;
		top: 10px;
		left: 30px;
		cursor: pointer;
	}
	#button:hover {
		color: darkred;
	}
	#directions {
		color: white;
		font-size: 15pt;
		font-weight: 100;
		position: relative;
		top: 70%;
		left: 30px;
	}
	</style>
</head>

<body>
	<div id="frontpage">
		<div id="title">PLANETARIUM</div>
		<div id="intro">A WebGL Project</div>
		<div id="directions">Matthew G. Kim</div>
		<div id="start">Start</div>
	</div>
	<div id="button">Planets</div>
	<script src="js/three.min.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/TrackballControls.js"></script>
	<script src="Planets.js"></script>

<script>
var centerCam = false;

$('#start').on('click', function(e) {
	//e.preventDefault();
	$("#frontpage").fadeOut();
	centerCam = true;
	$("#button").fadeIn();
});

var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, .1, 1000 );
camera.position.set(0,0,0);

var renderer = new THREE.WebGLRenderer();
renderer.setSize( window.innerWidth, window.innerHeight );
document.body.appendChild( renderer.domElement );
//var loader = new THREE.TextureLoader();

//replaced with TrackballControls
	// var orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
	// orbitControls.rotateRight(.25);
	// orbitControls.dollyOut(2.5);
	//controls.addEventListener('change', render);


//	SCROLL ZOOM
var scrollControls = new THREE.TrackballControls(camera);
scrollControls.rotateSpeed = .7;
scrollControls.zoomSpeed = 1;
scrollControls.panSpeed = .3;

scrollControls.noRotate = false;
scrollControls.noZoom = false;
scrollControls.noPan = false;

scrollControls.staticMoving = true;
scrollControls.dynamicDampingFactor = .2;

scrollControls.minDistance = 3;
scrollControls.maxDistance = 1500;

scrollControls.addEventListener('change', render);


//	CREATING THE 3D OBJECTS
var moon = new THREE.Mesh;
var mercury = new THREE.Mesh;
var venus = new THREE.Mesh;
var mars = new THREE.Mesh;
var jupiter = new THREE.Mesh;
var uranus = new THREE.Mesh;
var neptune = new THREE.Mesh;


var sphere = new THREE.SphereGeometry( 2,32,32 );
var material = new THREE.MeshPhongMaterial();
material.map = THREE.ImageUtils.loadTexture('textures/land_ocean_ice_cloud_2048.jpg');
var earth = new THREE.Mesh( sphere, material );
scene.add(earth);

var stars = new THREE.SphereGeometry(500,30,30);
var background = new THREE.MeshBasicMaterial();
background.map = THREE.ImageUtils.loadTexture('textures/starfield.png');
background.side = THREE.BackSide;
var starfield = new THREE.Mesh(stars, background);
scene.add(starfield);

//	INITIALIZE CAMERA POSITION AND SELECT TARGET PLANET
var target = earth;
camera.position.z = 1200;
camera.position.x = 10000;
camera.position.y = -100;

//	WINDOW
window.addEventListener('resize', onWindowResize, false);

function onWindowResize() {
	camera.aspect = window.innerWidth/window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
}


//centerView: Smooth, Automatic Camera movement
var centeredX=false;
var centeredY=false;
var centeredZ=false;

function centerView(planet) {

	if (centerCam) {
		if(planet.position.x != 0 || planet.position.y != 0 || planet.position.z != 0) {
			var vector = new THREE.Vector3(planet.position.x, planet.position.y, planet.position.z);
			vector.applyQuaternion(camera.quaternion);
			var angle = vector.angleTo(planet.position);
			if(planet.position>0) {
				camera.rotation.y-=angle;
			}
			else {
				camera.rotation.y+=angle;
			}
		}
		if (centeredX==false)
		{
			if(camera.position.x<planet.position.x+0.05 && camera.position.x>planet.position.x-0.05) {
				centeredX=true;
			}
			else if (camera.position.x>planet.position.x) {
				camera.position.x-=(camera.position.x-(planet.position.x))*.012;
			}
			else if (camera.position.x<planet.position.x) {
				camera.position.x+=(planet.position.x-(camera.position.x))*.012;
			}
		}

		if (centeredZ==false)
		{
			if (camera.position.z<planet.position.z+5.01 && camera.position.z>planet.position.z+4.9) {
				centeredZ=true;
			}
			else if (camera.position.z>planet.position.z+5) {
				camera.position.z-=(camera.position.z-(planet.position.z+5))*.012;
			}
			else if (camera.position.z<planet.position.z+5) {
				camera.position.z+=((planet.position.z+5)-camera.position.z)*.012;
			}
		}

		if (centeredY==false)
		{
			if(camera.position.y<planet.position.y+0.05 && camera.position.y>planet.position.y-0.05) {
				centeredY=true;
			}
			else if(camera.position.y>planet.position.y) {
				camera.position.y-=(camera.position.y-(planet.position.y))*.012;
			}
			else if (camera.position.y<planet.position.y) {
				camera.position.y+=(planet.position.y-(camera.position.y))*.012;
			}
		}
		if(centeredZ && centeredX && centeredY) {
			centerCam=false;
		}
	}
}

//	LIGHT
var light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(1,0,2);
scene.add(light);

	$("#button").on('click', function() {
		addMercury();
		addVenus();
		addMars();
		addJupiter();
		addSaturn();
		addUranus();
		addNeptune();
		$(this).fadeOut();
	});

	var render = function () {
		requestAnimationFrame( render );
		earth.rotation.y += 0.0015;
		starfield.rotation.y -=0.0005;
		mercury.rotation.y += 0.0015;
		venus.rotation.y -= 0.0012;
		mars.rotation.y += 0.0012;
		jupiter.rotation.y += 0.0005;
		//saturn.rotation.y += 0.0005;
		uranus.rotation.y += 0.0012;
		neptune.rotation.y += 0.0012;
		centerView(target);
		renderer.render( scene, camera );
		scrollControls.update();
	}
	render();
	</script>
</body>
</html>